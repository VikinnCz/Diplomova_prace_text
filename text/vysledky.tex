\chapter{Výsledky studentské práce}

% Referenční skladby http://isophonics.net/about


\section{Návrh výsledného systému}

V kapitole je popsán výsledný návrh výsledného systému. Systém se skládá z několika částí: uživatelské rozhraní, algoritmů pro získání pamrametrů hudební nahrávky, algoritmu generujícího SpectodaCode na základě získaných parametrů a databáze bloků. Podkapitoly pak podrobně popisují návrh každé z části systému.

%TODO: Předělat všechny proměnné značené $$ na \texttt{}

\subsection{Uživatelské rozhraní} \label{sec:User_interface}

Jedná se o jednoduché webové rozhraní, ve kterém uživatel nahraje hudební skladbu ve formátu .wav nebo mp3. Rozhraní obsahuje pole pro vložení cesty k hudební skladbě umožňující výběr ze souborů v uživatelově úložišti. Níže je posuvník s 4 základními hodnotami pro výběr nálady
\uv{mood}. Jedná se hodnoty \uv{chill}, \uv{hang out}, \uv{feeling happy} a \uv{dancing}, které jsou v tomto pořadí na posuvníku. Uživatel může pomocí posouvání posuvníku vybrat pro jakou náladu chce vytvořit animaci. Pod posuvníkem pro výběr nálady se nachází tlačítko spouštějící proces generování SpectodaCodu.
Poslední částí webového rozhraní je textové pole, ve kterém se zobrazí vygenerovaný kód. Na blokovém schématu \ref{fig:User_interaction_diagram} je zobrazen proces postupu uživatele skrze webové rozhraní. 

 \begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/User_interaction_diagram.pdf}
    \caption{Blokové schéma postupu uživatele webovou stránkou}
    \label{fig:User_interaction_diagram}
\end{figure}

\subsection{Parametry hudební nahrávky} \label{sec:Parametry_nahravky}

Systém pro generování SpectodaCode popsaný v bodě \ref{sec:System_generovani_animaci} vyžaduje vstupní data o hudební nahrávce. Tyto data jsou rozdělena na 7 parametrů. Každý z parametrů představuje vlastnost analyzované nahrávky. Tyto vlastnosti jsou získány pomocí technik popsaných v bodě \ref{sec:Exktrakce_vlastnosti_metody}. Jednotlivé vlastnosti a jejich datové struktury jsou shrnuty v následujících bodech.

\begin{description}
    \item[Detekce dob] představuje pole hodnot jehož délka je závislá na době trvání nahrávky. Jednotlivé hodnoty pak udávají časy hudební nahrávky, ve kterých se doby nacházejí. V rámci detekce dob je počítána také obálka síly nástupů jednotivých not. Jedná se o pole hodnot síly nástupů pro jednotlivé snímky. 
    
    \item[Tempo skladby] je číslo typu float s jednotkou \acs{BPM} vyjadřující počet úderů za minutu. Hodnota BPM se typicky vztahuje k počtu čtvrťových not za minutu \cite{Harvard_dictionary_of_music}. Vybraný algoritmus z knihovny Librosa neumožňuje rozeznat o jaké doby se jedné. Tempo je určeno jako počet detekovaných úderů za minutu. Postup zjištění tempa je popsán v bodě \ref{sec:Librosa}.

    \item[Chromavektory] jsou získány v podobě 2D pole. Počet řádků pole je dán 12 půltóny. Délka pole je závislá na délce nahrávky a velikosti okna při výpočtu \acs{STFT}. Z chromavektorů je spočítána paleta barev dané nahrávky. Paleta barev je uložena jako pole dvanácti hodnot. Pro každý půltón jedna barva. Generování barev je popsáno více v bodech \ref{sec:Color_palete} a \ref{sec:Parameter_extraction}.

    \item[Hlasitost] představuje normalizovanou vnímanou úroveň hlasitosti skladby s ohledem na vlastnosti lidského ucha popsané psychoakustikou. Je počítána buď pro celou skladbu, nebo její část/segment a je značena v jednotkách \acs{LUFS} Metoda výpočtu hlasitosti je popsána v bodě \ref{sec:Dynamika}.

    \item[Segmentace] rozděluje nahranou skladbu do 12 segmentů ve kterých se objevují stejné hudební tvary. Segmenty jsou uloženy jako pole časů hranic segmentů. Kde hranice představuje konec jednoho segmentu a začátek druhého. 

    \item[Žánr] je pro zvolenou nahrávku uložen v proměnné $genre$ pomocí slovníku 10 žánrů, ke kterým je přiřazena jejich pravděpodobnost. Protože se v hudbě vyskytuje velké množství žánrů, které se mezi sebou prolínají nejde s přesnou jistotou zařadit každou nahrávku přesně k jednomu žánru. Proto je použita metoda pravděpodobností. Použité žánry jsou popsány v úryvku kódu \ref{code:song_genre_variables}.
    \begin{figure}[H]
        \begin{lstlisting} [
            caption = {Hodnoty proměnné $genre$},
            captionpos=b,
            label = {code:song_genre_variables}]
            # Song genre constants
            BLUES       = "blues"
            CLASSICAL   = "classical"
            COUNTRY     = "country"
            DISCO       = "disco"
            HIPHOP      = "hiphop"
            JAZZ        = "jazz"
            METAL       = "metal"
            POP         = "pop"
            REGGAE      = "reggae"
            ROCK        = "rock"
        \end{lstlisting}
    \end{figure}

    \item[Nálada] představuje proměnou $mood$ typu float s přednastavenými statickými hodnotami zobrazenými v části kódu \ref{code:song_mood_variables}. Náladu zadává uživatel při nahrávání zvolené skladby.  
    \begin{figure}[H]        
        \begin{lstlisting}[
            caption = {Hodnoty proměnné $mood$},
            captionpos=b,
            label = {code:song_mood_variables}]
            # Song mood constants
            CHILL       = 0
            HANG_OUT    = 1
            HAPPY       = 2
            DANCING     = 3
        \end{lstlisting}
    \end{figure}
    
\end{description}

\subsection{Databáze bloků animací} \label{sec:Database_structure}
Jak je popsáno v bodě \ref{sec:Spectoda} systém Spectoda obsahuje základní animace, které jsou skládány do bloků a tím vznikají komplexní struktury. Systém využívá již připravených bloků animací, které jsou uloženy jako objekty. Těmto objektům jsou přiřazeny parametry $code$, $characteristics$, $length$ a $colors$. Jejich struktura je zapsaná datovou třídou $AnimationBlock$. Z objektů třídy jsou dále tvořeny datasety zapsané třídou $Dataset$. Tyto instance obsahují 5 bloků animací a parametry $genre$, $tempo$ a $mood$. UML diagramy tříd jsou zobrazeny na obrázku \ref{fig:UML_diagram_Dataset_AnimationBlock}.

\begin{figure}[H]
    \centering
    \includegraphics[width = 0.7\linewidth]{obrazky/UML_diagram_Dataset_and_AnimationBlock.pdf}
    \caption{Blokové diagramy tříd $Dataset$, $AnimationBlock$}
    \label{fig:UML_diagram_Dataset_AnimationBlock}
\end{figure}

Jak bylo zmíněno bloky animací mají proměnou $characteristic$, které je rozděluje do 5 kategorií. Každá kategorie má svůj specifický význam: 

\begin{itemize}
    \item BANG -- Vhodné pro začátek krátkých segmentů. Velmi úderné a rychlé.
    \item SHOT -- Rychlé animace pro kratší segmenty.
    \item PULL -- Úderné animace, které vtáhnou do děje na začátku delších segmentů.
    \item THEME -- Primární animace pro delší segmenty obsahuje hlavní téma.
    \item FLOW -- Dlouhé pomalé animace pro vyplnění klidných částí skladby.
\end{itemize}

\begin{figure}[H]
    \begin{lstlisting}[
        caption = {Hodnoty proměnné $characteristics$},
        captionpos=b,
        label = {code:anim_characteristic_constants}]
        # Animation characteristics constants
        BANG        = 0
        SHOT        = 1
        PULL        = 2
        THEME       = 3
        FLOW        = 4
    \end{lstlisting}
\end{figure}

\subsection{Systém pro generování animací} \label{sec:System_generovani_animaci}

Systém pro generování animací je jádrem práce. Jeho struktura udává vizuální kvalitu animací a schopnost přizpůsobit se různorodým skladbám. V této kapitole je popsána struktura zmíněného systému. 

První částí systému je vstupní rozhraní, ve kterém jsou přijímány data obsahující vlastnosti hudební nahrávky. Struktura přijímaných dat je popsána v bodě \ref{sec:Parametry_nahravky}. Každý ze zmíněných parametrů plní důležitou funkci v rozhodovacím procesu skládání bloků animace. Níže jsou popsány rozhodovací funkce pro jednotlivé parametry.

\begin{description}
    \item[Žánr a nálada] jsou používány pro výběr vhodného balíčku animací. Tyto balíčky jsou nazývány datasety a jejich datová struktura je popsána v bodě \ref{sec:Database_structure}. Postup výběru datasetu je následující. Každý dataset obsahuje konstantní hodnotu nálady $mood$ a seznam všech deseti používaných žánrů. Ke každému žánru je přiřazeno racionální číslo udávající hodnotu jak moc je dataset pro daný žánr vhodný. Kde 1 je nejvíce vhodný a 0 nejméně. Na základě seznamu $genre$ dochází k postupnému seřazení všech, datasetů dle jejich vhodnosti pro nahraný audio soubor, a výběru 5 nejvíce se hodících. V dalším kroku jsou vyřazeny všechny datasety, které neodpovídají zvolené náladě $mood$. Programové řešení výběru vhodného datasetu je popsáno v bodě \ref{sec:Vyber_datasetu}
    
    \begin{figure}[H]
        \centering
        \includegraphics[width = 1\linewidth]{obrazky/Dataset_selection_diagram.pdf}
        \caption{Blokový diagram výběru datasetu.}
        \label{fig:Dataset_selection_diagram}
    \end{figure}

    \item[Tempo skladby] je posledním parametrem při výběru vhodného datasetu. Všechny zbývající datasety jsou porovnány s odhadovaným tempem skladby a je stanoven rozdíl jejich hodnot. Jako výsledný dataset je vybrán ten který má hodnotu rozdílu tempa nejmenší. Celý postup je znázorněn na obrázku \ref{fig:Dataset_selection_diagram}.
    
    \item[Segmentace] má důležitou roli při výběru vhodných bloků animací. U každého ze segmentů je počítána jeho délka a hlasitost tyto údaje jsou pak porovnávány vůči celé skladbě. Na základě těchto údajů jsou segmenty děleny na: hlasité, tiché, krátké a dlouhé. Práce se segmenty v programu je popsána v bodě \ref{sec:Vyber_bloku_animace}

    \item[Detekce dob] udává časy kde se v nahrávce nahrávají doby. V systému je tento parametr důležitý zejména pro správné umístění začátku a konce animace, tak aby seděla do rytmu nahrávky. 

    \item[Obálka síly nástupů] z anglického pojmu onset strength envelope je hodnota na základě které je určena významnost jednotlivých dob. Tato významnost je brána jako nejvyšší hodnota obálky síly nástupů v okolí dané doby.
     
    \item[Chroma vektory] udávají tónovou strukturu skladby v průběhu času. Tento parametr je využit pro nastavení barev animace. Chromavektory se analyzují a jsou vybrány 3 hlavní tóny nejčastěji se znějící v nahrávce. Každému z tónů je přiřazen barevný odstín tak, aby se jednalo o barvy triadické. Zbývajícím tónům jsou přiřazeny odstíny těchto barev a jsou uloženy jako barevná paleta nahrávky. U jednotlivých animací jsou na základě počtu barev v údaji $colors$ z chromavektorů vypočítány nejvíce se vyskytující tóny. Na základě těchto tónů jsou animaci přiřazeny barvy z palety barev. Celý proces generování a přiřazování barev je popsán v bodě \ref{sec:Color_palete}.

    \item[Hlasitost] pomáhá procesu segmentace. Refrén a sloka se mohou lišit hlasitostí. Hlasitost je počítána pro celou skladbu a následně pro segmenty. Při výběru vhodného bloku animace dochází k porovnání hlasitosti segmentu vůči hlasitosti nahrávky. Na základě porovnání je určeno jak výrazné mají být animace v daném segmentu. Vyšší hodnoty představují rychlejší a údernější animace. Nižší hodnoty naopak pomalejší a klidnější animace.
\end{description}


Druhá část systému tvoří samotnou logiku skládání bloků animací. Rozhodovací struktura lze zjednodušit na několik po sobě jdoucích kroků znázorněných blokovým diagramem na obrázku \ref{fig:diagram_procesu_generovani_animaci}. V bodech níže jsou postupně popsány všechny kroky.

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/UML_diagramy_anim_generation_process.pdf}
    \caption{Blokový diagram procesu generování animací}
    \label{fig:diagram_procesu_generovani_animaci}
\end{figure}

\begin{itemize}
    \item  
    Prvním z bloků je přiřazení času začátku animace. Pokud se jedná o počáteční animaci ve skladbě je automaticky přiřazen jako začátek čas, ve kterém se nachází první doba. Pro každou další animaci je volen čas začátku jako konec animace předchozí. 
    \item 
    Druhým krokem je nalezení segmentu, ve kterém se začátek animace nachází. Segment je vyjádřen jako jeho hranice začátku a konce. Tyto hranice jsou nalezeny v poli hranic segmentů jako nejbližší nižší a nejbližší vyšší čas k času začátku animace. Funkce pro vyhledání segmentu je zobrazena v úryvku kódu \ref{code:Find_segment}. 

    \item 
    Třetím krokem v pořadí je výběr vhodného bloku animace. Výběr vhodného bloku je důležitý pro výsledný pocit z konečné animace. Ze získaných parametrů o nahrávce je vypočítáno dalších 7 hodnot. Na získané hodnoty jsou aplikovány váhy a poté jso mezi sebou porovnány. Výsledkem procesu jsou 3 proměnné typu boolean představující otázky: Je segment dlouhý? Je segment hlasitý? Je doba začátku animace důležitá v segmentu? Je doba začátku animace důležitá v nahrávce? Pro lepší představu je struktura procesu zobrazená na blokovém diagramu \ref{fig:Logical_structure_diagram}. Na základě získaných logických proměnných je pomocí rozhodovací struktury vybrána vhodná charakteristika animace. Výběr charakteristiky je zobrazen v úryvku kódu \ref{code:Char_selection}. Struktura je tvořena dvěma kroky a v každém kroku jsou 4 řešení. Výsledný počet řešení je tedy $2^4 = 16$. První je porovnávánao jestli je segment dlouhý a hlasitý. Kombinace těchto dvou stavů (ano/ne) tvoří první čtyři zmíněné řešení. Ve druhém kroku je porovnávána důležitost počáteční doby animace v segmentu a skladbě. Toto porovnání nabývá také 4 možných řešení.  

    \begin{figure}[H]
        \centering
        \includegraphics[width = 1\linewidth]{obrazky/UML_diagramy_anim_bock_selection _part_1.pdf}
        \caption{Blokový diagram procesu výpočtu parametrů pro výběr animace}
        \label{fig:Anim_block_param_selection_diagram}
    \end{figure}

    \item Poté co je vybrán vhodný blok animace je důležité upravit její délku tak, aby končila opět době. Každý blok má nastavenou doporučenou délku uloženou v proměnné \texttt{anim\_length}. Nejprve je vypočítán čas konce animace jako součet začátku animace a její doporučené délky. Pomocí funkce \texttt{Find\_nearest\_beat} zobrazené v úryvku kódu \ref{code:Find_nearest_beat} je nalezena doba, která má nejmenší časový rozdíl od vypočítaného konce animace. Nyní je známa doba na které bude animace konči, ještě je ale potřeba vypočítat modifikátor, který upraví délku animace tak, aby na ní skutečně skončila. Modifikátor je číslo, kterým je násobena doporučená délka animace tak aby odpovídala délce mezi vybranou počáteční dobou a koncovou dobou. Výpočet je znázorněn rovnicemi \ref{rov:time_modifier}, kde $M$ je modifikátor, $T_a$ je doporučený čas animace, $T_n$ je nový čas animace, $T_{eb}$ je čas ve kterém se nachází konečná doba animace a $T_{sb}$ je čas ve kterém se nachází počáteční doba animace.
    
    \begin{equation}
        M = \frac{T_a}{T_n} = \frac{T_a}{T_{eb} - T_{sb}}
        \label{rov:time_modifier}
    \end{equation}
    
    \item Nyní je možné vybrat barvy s palety barev dané nahrávky. Nejprve jsou z chromavektorů vypočítány tóny, které zní nejdéle v časovém rozmezí bloku animace. Z proměné \texttt{anim\_color} uložené v bloku animace zjistíme kolik je potřeba barev. Na základě zjištěného počtu je vybráno z palety barev vybráno n barev, které odpovídají nejvíce znělým tónům v dané části skladby. 

    \item Šestým krokem je vygenerování kódu animace. Zdrojový kód je uložen v proměnné \texttt{anim\_code} vybraného bloku. Do něj je potřeba na předpřipravená místa vložit získané informace o začátku, konci, rychlosti a barvě. Po vložení těchto informací je v textovém řetězci uložen do pole jako další hotová animace. 
    
    \item Posledním bodem cyklu je kontrola jestli je konec animace poslední dobou v skladbě. Pokud není cyklus se opakuje stále dokola než je vygenerován kód pro všechny části nahrávky. Po dokončení tohoto procesu je pole vygenerovaných zdrojových kódů sečteno do jednoho dlouhého řetězce jako finální kód animace a je připraven k nahrání do Spectoda zařízení. 
    
\end{itemize}

% Na začátku je zjištěno jestli se jedná o první blok animace. Pokud ano je nastaven čas začátku animace jako čas první doby v nahrávce. Jestli se nejedná o první blok animace, tak je nastaven čas začátku jako konec předchozího bloku animace. Tento proces v blokovém schématu \ref{} představuje proces s názvem \uv{Nastavení času začátku animace}. Druhým krokem je rozhodovací struktura jestli se vybraný čas začátku nachází v segmentu nahrávky který se opakuje. Pokud ano je nalezen blok animace ve stejném času předchozího segmentu a je zkontrolováno  

\section{Metody extrakce parametrů z hudební nahrávky} \label{sec:Exktrakce_vlastnosti_metody}
Díky vědecké komunitě vznikly volně dostupné knihovny obsahující techniky z oborů \acs{MIR}. V této části práce jsou prozkoumány 3 knihovny zmíněné v bodě \ref{sec:Dostupna_reseni}. Jsou porovnány jejich funkce pro získání parametrů z hudební nahrávky. Tyto funkce jsou mezi sebou porovnány z hlediska přesnosti výsledků, rychlosti výpočtů, jednoduchosti použití a možnosti využití pro komerční účely. 

\subsection{Detekce dob a tempa}
Pro porovnání detekce dob jsou vybrány 3 funkce. Pro každou knihovnu jedna funkce. První je z knihovny Librosa funkce \texttt{beat\_track}. Z knihovny Madmom je použit \texttt{BeatTrackingProcessor} a z knihovny Aubio funkce \texttt{tempo}. Funkce jsou porovnány na třech skladbách skupiny Beatles. Níže v grafu \ref{fig:Oh-Darling_beat_analysis} je vidět úryvek skladby Oh-Darling!. Pro lepší zobrazení jsou osy grafu v rozsahu 55 - 65 sekund nahrávky. Na prvním z grafů je vyobrazen mel spektrogram vypočítán pomocí funkce \texttt{melspectrogram} z knihovny Librosa. Grafy b), c) a d) zobrazují v pozadí obálku síly nástupů a vertikální pruhované čáry znázorňují detekované doby dané funkce. Vertikální modré tečkované čáry jsou referenční doby zaznamenané institucí Centre for digital music na univerzitě Queen Mary, University of London \cite{Isophonic}. 

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/Oh-Darling_Beat_analysis_graphs.eps}
    \caption{Porovnání metod detekce dob na úryvku skladby Oh-Darling!. \textbf{a)} Mel spektrogram \textbf{b)}Detekce dob pomocí Librosa \textbf{c)} Detekce dob pomocí Madmom \textbf{d)} Detekce dob pomocí Aubio}
    \label{fig:Oh-Darling_beat_analysis}
\end{figure}

Z grafu lze vidět, že funkce z knihoven Librosa a Madmom se nejvíce přibližují referenčním dobám. Pro přesné hodnocení funkcí je využita knihovna Mir\_eval poskytující funkce pro hodnocení přesnosti detekce dob. Pomocí teto knihovny je počítáno Camgil skóre. Popis knihovny a výpočtu je zmíněn v bodě \ref{sec:Mir_eval}. Posledním hodnoceným parametrem je doba výpočtu. Výsledky Camgil skóre, a doby výpočtu pro jednotlivé skladby jsou zobrazeny na obrázku \ref{fig:Beat_tracking_time_and_cemgil}.

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/Beat_tracking_time_and_cemgil_graphs.eps}
    \caption{Porovnání přesnosti a času metod detekce dob na skladbách Oh-Darling!, Come Together a Here Comes The Sun. \textbf{a)} Čas výpočtu \textbf{b)}Cemgil skóre}
    \label{fig:Beat_tracking_time_and_cemgil}
\end{figure}

\subsection{Analýza chromavektorů}

Hodnocení vhodné funkce pro výpočet chromavektorů je realizováno zejména vizuálně na zobrazených grafech referenčních skladeb. Tyto grafy lze vidět na obrázku \ref{fig:Chroma_analysis}. Porovnávány jsou 4 funkce z knihovny librosa \texttt{chroma\_stft}, \texttt{chroma\_cqt}, \texttt{chroma\_cens} a čtvrtou je funkce \texttt{chroma\_cqt} s řetězci předzpracování signálu a filtrací výsledných chromavektorů. Principy výpočtů jednotlivých funkcí jsou popsány v bodě \ref{sec:Librosa}. Z knihovny Madmom je použit \textit{DeepChromaProcessor}.

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/Oh-Darling_chroma_analysis_graphs.eps}
    \caption{Porovnání výpočtu chromavektorů na skladbě Oh-Darling! v časovém rozmezí 0 - 60 s.}
    \label{fig:Chroma_analysis}
\end{figure}

Z obrázku \ref{fig:Chroma_analysis} lze vidět patrný rozdíl v přístupu výpočtu chromavektorů. U grafů \textit{b)}, \textit{c)} a \textit{d)} lze vidět velké množství šumu. U grafu \textit{e)} je šum vyfiltrován přidanými metodami. Na grafu \textit{f)} lze vidět, že knihovna Madmom a z ní použitý \texttt{DeepChromaProcessor} přistupuje k výpočtu chromavektorů odlišně. Je využito delší časové okno pro transformaci do frekvenční oblasti. Z toho je patrné, že v časovém měřítku údaj není natolik přesný jako u knihovny Librosa. Pro následné použití v algoritmu pro generování animací je však tento výsledek mnohem stálejší. 

Dalším hodnoceným parametrem je délka výpočtu chromavektorů. Ta je závislá na složitosti algoritmů jež funkce využívají k výpočtu. Porovnání je zobrazeno na obrázku \ref{fig:Chroma_calculation_time}. Z obrázku je zřejmé, že pomocné metody pro předzpracování a filtraci chromavektorů z funkce \textit{chroma\_cqt} přidaly značné množství výpočetního času oproti samotnému výpočtu chromavektorů.

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/Chroma_analysis_times_comparison.eps}
    \caption{Porovnání délky výpočtu chromavektorů}
    \label{fig:Chroma_calculation_time}
\end{figure}
    
\subsection{Efektivní hodnota signálu}
Výpočet efektivní hodnoty signálu je realizován pomocí funkce z knihovy Librosa. Pro výpočet je použito okno o délce 2048 vzorků. Hodnoty jsou vycentrovány na střed rozsahu okna tedy 1024 vzorků. Získaná křivka je uhlazena pomocí výpočtu klouzavého průměru. Počet vzorků ze kterých se klouzavý průměr vypočítá odpovídá délce signálu $7,5 s$ a je závislý na jeho vzorkovací frekvenci. Získané křivky jsou zobrazeny na obrázku \ref{fig:RMS_calculation}.

\begin{figure}[H]
    \centering
    \includegraphics[width = 1\linewidth]{obrazky/Belly_dancer_RMS.eps}
    \caption{Zobrazení efektivní hodnoty skladby Belly dancer}
    \label{fig:RMS_calculation}
\end{figure}

\subsection{Hlasitost}
Pro výpočet hlasitosti skladby nebo jejich částí je použita knihovna \texttt{Pyloudnorm} \cite{Pyloudnorm}. Tato knihovna implementuje standardizovaný algoritmus ITU-R BS.1770 \cite{BS.1770}. Který je více popsaný v bodě \ref{sec:Dynamika}. Výstupní hodnotou funke je číselná hodnota udávající hlasitost skladby nebo jejich částí v jednotkách LUFS. 

\section{Realizace} \label{sec:Realizace}

Kapitola popisuje jakým způsobem bylo dosaženo funkčního prototypu systému pro generování animací na základě parametrů hudební nahrávky. Jsou zde popsány použité programovací jazyky, metody a algoritmy. Podrobně je popsáno programové řešení jednotlivých částí systému. 

\subsection{Uživatelské rozhraní}

Uživatelské rozhraní je reprezentováno webovou stránkou a je naprogramováno pomocí značkovacího jazyka \acs{HTML}\footnote{HTML -- Hypertext markup language. Je značkovací jazyk používaný pro tvorbu webových stránek.} spolu s formátováním v jazyce \acs{CSS}\footnote{CSS -- Cascading style sheets. Je jazyk popisující styl zobrazení HTML elementů\cite{CSS}.}. Aby bylo možné k webové stránce přistupovat veřejně je nasazena serveru služby PythonAnywhere. Která poskytuje cloudové řešení pro realizaci python aplikací. Funkčnost a propojení webového rozhraní s python systémem pracujícím na pozadí je řešeno pomocí frameworku Flask. Flask umožňuje jednoduchou interakci webové stránky s python aplikací běžící na pozadí pomocí protokolu HTTP\footnote{HTTP -- Hypertext transfer protocol. Je protokol navržen pro komunikaci mezi klientem a serverem.}. V rámci webové aplikace je využito pouze metod \texttt{GET} a \texttt{POST}. Kde metoda \texttt{POST} slouží pro odeslání dat s přiřazenou nahrávkou a vybranou náladou.

\subsection{Extrakce parametrů} \label{sec:Parameter_extraction}
Pro získání všech potřebných paramtrů z nahraného audio souboru jsou naprogramovány čtyři třídy. Tyto třídy poskytují veškeré potřebné parametry. V textu níže je postupně popsána jejich vnitřní struktura a funkce které obstarávají. 

První třída \texttt{BeatTracking} je zaměřená na detekci síly nástupů, dob a tempa. Je tvořena s .... parametrů a obsahuje metody pro ...  

\begin{figure}[H]
    \centering
        \includegraphics[width = 0.3\linewidth]{obrazky/UML_diagram_ChromaFeatures.pdf}
        \caption{Struktura třídy \textit{ChromaFeatures}}
        \label{fig:ChromaFeatures_class_diagram}
    \end{figure}


Pro práci se segmenty je definována třída \textit{Segmentation} a její struktura je zobrazena na obrázku \ref{fig:Segmentation_diagram}.

\begin{figure}[H]
    \centering
    \includegraphics[width = 0.3\linewidth]{obrazky/UML_diagram_Segmentation.pdf}
    \caption{Struktura třídy $Segment$}
    \label{fig:Segmentation_diagram}
\end{figure}

%TODO: Zde popíšu kompletní strukturu tříd a procesy v nich probíhající. 

\subsection{Paleta barev} \label{sec:Color_palete}
    Barvy jsou zadány v souřadnicích \acs{HSV} a každá
    % TODO: Triadické míchání barev v rámci chroma features

\subsection{Výběr datasetu} \label{sec:Vyber_datasetu}

\subsection{Výběr bloku animace} \label{sec:Vyber_bloku_animace}


    % \section{Návrhy na zlepšení}
    % V této kapitole jsou v odrážkách popsány body a návrehy pro realizaci a zlepšení výsledného systému. 

    % \begin{itemize}
    % \item Prozkoumat oblasti automatické detekce hudebních žánrů a následně realizovat vhodné řešení. Tento parametry je důležitý pro výběr vhodného datasetu. 
    % \item Vhodně realizovat segmentaci skladby na jednotlivé části popsané v návrhu segmentace v bodě. \ref{sec:Parametry_nahravky}
    % \item Zajímavým bodem pro prozkoumání je porovnání efektivní hodnoty signálu s hlasitostí vypočítanou v jednoce LUFS stanovenou normami EBU R 128 \cite{EBU_R_128}. 
    % \item Pro vhodnější výběr bloků animací je možné použít obálku síly nástupů. Na základě které lze určitě sílu daného nástupu a předpokládat významnost doby.
    % \end{itemize}

% Domyslení procesu přiřazování palety barev a který z chromavektrů bude využit.

